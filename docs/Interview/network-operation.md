# 运行机制专题
## 1. 导航流程：  
从输入URL到页面展示，这中间发生了什么？**请求、下载、渲染**，5（阶段） + 6 + 8  
1.1 用户输入，beforUnload  
1.2 **URL请求过程**[重点]，6部分（**构建请求查缓存；路过DNS解析；等待建立TCP；发送HTTP为完结；**） 
```js
1.2.1 构建请求  
1.2.2 查找缓存[先强后协商]  
1.2.3 DNS解析：找到对应的IP地址；
              默认IP的80端口；
              HTTP是应用层协议；TCP/IP 是传输层协议，浏览器提供DNS缓存服务；如果是https，还需要加上TLS连接；  
1.2.4 等待TCP队列：同域名同时只能建6个连接，其余到进队列排队  
1.2.5 建立TCP连接：三次握手保连接，四次挥手保断开。  
1.2.6 发送HTTP请求：响应完了，查看Connection：Keep-Alive，那就保持TCP不断，进行后面复用。  
```

1.3 准备渲染进程：Chrome默认会给每个页面分配一个渲染进程，也存在多个页面公用一个渲染进程的情况。  
1.4 提交文档：指浏览器进程把网络进程获取到的HTML数据提交给渲染进程  
1.5 **渲染阶段**[重点]：页面解析和子资源的加载，8部分  (**构建DOM树、样布(局)分(层)绘、分块、栅化和合成**) 
```js
1.5.1 构建DOM树、样式计算、布局阶段、分层  
1.5.2 绘制、分块、光珊化、合成 
``` 

## 2. TCP连接过程：
    2.1 通过 三次握手 进行连接：指客户端和服务器要通过发送三次数据包来确定连接的建立。  
    2.2 传输数据阶段，接收端都要进行确认操作。  
    2.3 通过 四次挥手 进行断开：保证双方都能断开。 
参链：[面试官，不要再问我三次握手和四次挥手](https://zhuanlan.zhihu.com/p/86426969) todo，深入了解篇

## 3. 状态码： 
    1xx：信息状态码；2xx：成功状态码；3xx：重定向；4xx：客户端错误；5xx：服务端错误；  
    400 请求无效 403 禁止访问 404 页面不存在 401需要权限 500 服务器错误  
    301：永久移动；302：临时移动；304：Not Modified，通常指浏览器缓存了数据，客户端头部会指定返回特定日期后面的数据

参链：
* 1. [web前端开发笔试题之HTTP状态码](https://blog.csdn.net/ojbk_1627/article/details/101600911)

## 4. 渲染流程：(7步)
* 1. 构建DOM树：经由HTML解析器解析，DOM树是存储在内存里的  
* 2. 样式计算：把CSS转换成浏览器能理解的结构，styleSheets  
* 3. 布局阶段：计算出可见区域的几何位置；创建布局树；布局计算 下一个布局系统 **LayoutNG** ；  
* 4. 分层：为特定节点生成专用图层，比如：定位、透明、滤镜，并生成对应的图层树(LayerTree)  
* 5. 绘制：拆分为小的绘制指令，组成一个**待绘制列表**。  
* 6. 分块
* 7. 光珊化：raster，渲染引擎中的合成线程来完成，**把图块转换成位图**。  
* 8. 合成显示：**浏览器进程的viz组件**接收DrawQuad命令，将页面内容绘制到内存中，再由内存中显示到屏幕上。  

## 5. 重绘&重排
* 1. 重绘：更新元素的绘制属性
* 2. 重排：更新元素的几何属性  
* 3. 直接合成阶段：使用transform来合成动画会避开重排和重绘，在非主线程上绘制，会极大的提高效率。

## 6. defer&async
* 1. defer: 聪明的孩子，并行下载，等待执行；在文档渲染完毕后，DOMContentLoaded事件调用前执行。
* 2. async：顽皮的孩子，并行下载，立即执行；不受DOMContentLoaded影响

参链：
* 1. [script标签中async和defer的用法](https://www.php.cn/div-tutorial-380358.html)