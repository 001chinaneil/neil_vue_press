<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端工程化管理工具篇 | 持续变强</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/neil_vue_press/assets/css/0.styles.b423781f.css" as="style"><link rel="preload" href="/neil_vue_press/assets/js/app.ce6058cf.js" as="script"><link rel="preload" href="/neil_vue_press/assets/js/2.616e7873.js" as="script"><link rel="preload" href="/neil_vue_press/assets/js/1.6e2e3eb2.js" as="script"><link rel="preload" href="/neil_vue_press/assets/js/19.d3e902f6.js" as="script"><link rel="prefetch" href="/neil_vue_press/assets/js/10.c2ddce70.js"><link rel="prefetch" href="/neil_vue_press/assets/js/100.2cb9245d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/101.1e358b93.js"><link rel="prefetch" href="/neil_vue_press/assets/js/102.55fdfb04.js"><link rel="prefetch" href="/neil_vue_press/assets/js/103.b80c8053.js"><link rel="prefetch" href="/neil_vue_press/assets/js/104.979131ae.js"><link rel="prefetch" href="/neil_vue_press/assets/js/105.a1956f88.js"><link rel="prefetch" href="/neil_vue_press/assets/js/106.3ecdcf48.js"><link rel="prefetch" href="/neil_vue_press/assets/js/107.42e05011.js"><link rel="prefetch" href="/neil_vue_press/assets/js/108.ad556a13.js"><link rel="prefetch" href="/neil_vue_press/assets/js/109.2ba7058b.js"><link rel="prefetch" href="/neil_vue_press/assets/js/11.845e3692.js"><link rel="prefetch" href="/neil_vue_press/assets/js/110.ee3de1be.js"><link rel="prefetch" href="/neil_vue_press/assets/js/12.10f4b7b2.js"><link rel="prefetch" href="/neil_vue_press/assets/js/13.dba8623a.js"><link rel="prefetch" href="/neil_vue_press/assets/js/14.259dac0a.js"><link rel="prefetch" href="/neil_vue_press/assets/js/15.b60f3925.js"><link rel="prefetch" href="/neil_vue_press/assets/js/16.b796cb59.js"><link rel="prefetch" href="/neil_vue_press/assets/js/17.c2838453.js"><link rel="prefetch" href="/neil_vue_press/assets/js/18.3256f17f.js"><link rel="prefetch" href="/neil_vue_press/assets/js/20.a728a170.js"><link rel="prefetch" href="/neil_vue_press/assets/js/21.8f6f4046.js"><link rel="prefetch" href="/neil_vue_press/assets/js/22.6180816b.js"><link rel="prefetch" href="/neil_vue_press/assets/js/23.3c2328ca.js"><link rel="prefetch" href="/neil_vue_press/assets/js/24.78abee10.js"><link rel="prefetch" href="/neil_vue_press/assets/js/25.d061ec60.js"><link rel="prefetch" href="/neil_vue_press/assets/js/26.67bd2e77.js"><link rel="prefetch" href="/neil_vue_press/assets/js/27.4d5b3ea3.js"><link rel="prefetch" href="/neil_vue_press/assets/js/28.1b582b51.js"><link rel="prefetch" href="/neil_vue_press/assets/js/29.046359c9.js"><link rel="prefetch" href="/neil_vue_press/assets/js/3.a6d02328.js"><link rel="prefetch" href="/neil_vue_press/assets/js/30.143f6735.js"><link rel="prefetch" href="/neil_vue_press/assets/js/31.80ba92d3.js"><link rel="prefetch" href="/neil_vue_press/assets/js/32.cb7ea2f7.js"><link rel="prefetch" href="/neil_vue_press/assets/js/33.d40c5d8a.js"><link rel="prefetch" href="/neil_vue_press/assets/js/34.a10b04f5.js"><link rel="prefetch" href="/neil_vue_press/assets/js/35.54845dae.js"><link rel="prefetch" href="/neil_vue_press/assets/js/36.cfafa0da.js"><link rel="prefetch" href="/neil_vue_press/assets/js/37.3e5d624d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/38.a5a958bc.js"><link rel="prefetch" href="/neil_vue_press/assets/js/39.d05ad086.js"><link rel="prefetch" href="/neil_vue_press/assets/js/4.04fd32fe.js"><link rel="prefetch" href="/neil_vue_press/assets/js/40.bb947383.js"><link rel="prefetch" href="/neil_vue_press/assets/js/41.de491c94.js"><link rel="prefetch" href="/neil_vue_press/assets/js/42.0a776717.js"><link rel="prefetch" href="/neil_vue_press/assets/js/43.038a8d56.js"><link rel="prefetch" href="/neil_vue_press/assets/js/44.c7acfc0e.js"><link rel="prefetch" href="/neil_vue_press/assets/js/45.e7ebfbcf.js"><link rel="prefetch" href="/neil_vue_press/assets/js/46.316704dd.js"><link rel="prefetch" href="/neil_vue_press/assets/js/47.6771bc4a.js"><link rel="prefetch" href="/neil_vue_press/assets/js/48.9938ad53.js"><link rel="prefetch" href="/neil_vue_press/assets/js/49.ff90db2c.js"><link rel="prefetch" href="/neil_vue_press/assets/js/5.0aa2b161.js"><link rel="prefetch" href="/neil_vue_press/assets/js/50.3196afa1.js"><link rel="prefetch" href="/neil_vue_press/assets/js/51.e3772f9b.js"><link rel="prefetch" href="/neil_vue_press/assets/js/52.2f6cbd27.js"><link rel="prefetch" href="/neil_vue_press/assets/js/53.fc12321e.js"><link rel="prefetch" href="/neil_vue_press/assets/js/54.7a7c4e21.js"><link rel="prefetch" href="/neil_vue_press/assets/js/55.b21d1be6.js"><link rel="prefetch" href="/neil_vue_press/assets/js/56.40699bad.js"><link rel="prefetch" href="/neil_vue_press/assets/js/57.a07bc75d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/58.5beb39bc.js"><link rel="prefetch" href="/neil_vue_press/assets/js/59.c2ffae8c.js"><link rel="prefetch" href="/neil_vue_press/assets/js/6.5ff9fa87.js"><link rel="prefetch" href="/neil_vue_press/assets/js/60.991c757f.js"><link rel="prefetch" href="/neil_vue_press/assets/js/61.a6514398.js"><link rel="prefetch" href="/neil_vue_press/assets/js/62.e08e24fb.js"><link rel="prefetch" href="/neil_vue_press/assets/js/63.8386491e.js"><link rel="prefetch" href="/neil_vue_press/assets/js/64.a14853d9.js"><link rel="prefetch" href="/neil_vue_press/assets/js/65.a17567bb.js"><link rel="prefetch" href="/neil_vue_press/assets/js/66.d5d1e04a.js"><link rel="prefetch" href="/neil_vue_press/assets/js/67.1bfda088.js"><link rel="prefetch" href="/neil_vue_press/assets/js/68.6533e609.js"><link rel="prefetch" href="/neil_vue_press/assets/js/69.fb54d3b7.js"><link rel="prefetch" href="/neil_vue_press/assets/js/7.8850a23c.js"><link rel="prefetch" href="/neil_vue_press/assets/js/70.7b7df945.js"><link rel="prefetch" href="/neil_vue_press/assets/js/71.998c2e96.js"><link rel="prefetch" href="/neil_vue_press/assets/js/72.ca6a4db9.js"><link rel="prefetch" href="/neil_vue_press/assets/js/73.069571b5.js"><link rel="prefetch" href="/neil_vue_press/assets/js/74.18db3841.js"><link rel="prefetch" href="/neil_vue_press/assets/js/75.a852404f.js"><link rel="prefetch" href="/neil_vue_press/assets/js/76.06c7645f.js"><link rel="prefetch" href="/neil_vue_press/assets/js/77.a5b01d75.js"><link rel="prefetch" href="/neil_vue_press/assets/js/78.cafc53e7.js"><link rel="prefetch" href="/neil_vue_press/assets/js/79.b81b3a53.js"><link rel="prefetch" href="/neil_vue_press/assets/js/80.b1be442d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/81.c7aae388.js"><link rel="prefetch" href="/neil_vue_press/assets/js/82.45aa3e6d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/83.6395039d.js"><link rel="prefetch" href="/neil_vue_press/assets/js/84.c3765f18.js"><link rel="prefetch" href="/neil_vue_press/assets/js/85.02c6c2d7.js"><link rel="prefetch" href="/neil_vue_press/assets/js/86.b1d91626.js"><link rel="prefetch" href="/neil_vue_press/assets/js/87.58091c3f.js"><link rel="prefetch" href="/neil_vue_press/assets/js/88.b19349dc.js"><link rel="prefetch" href="/neil_vue_press/assets/js/89.32ae16c9.js"><link rel="prefetch" href="/neil_vue_press/assets/js/90.5dea43f5.js"><link rel="prefetch" href="/neil_vue_press/assets/js/91.355ef21c.js"><link rel="prefetch" href="/neil_vue_press/assets/js/92.c6f036f6.js"><link rel="prefetch" href="/neil_vue_press/assets/js/93.3e70ded6.js"><link rel="prefetch" href="/neil_vue_press/assets/js/94.3602f9b0.js"><link rel="prefetch" href="/neil_vue_press/assets/js/95.85b9ef99.js"><link rel="prefetch" href="/neil_vue_press/assets/js/96.15dca093.js"><link rel="prefetch" href="/neil_vue_press/assets/js/97.cfefcb22.js"><link rel="prefetch" href="/neil_vue_press/assets/js/98.398cea51.js"><link rel="prefetch" href="/neil_vue_press/assets/js/99.06c5735b.js"><link rel="prefetch" href="/neil_vue_press/assets/js/vendors~docsearch.3d49b2ab.js">
    <link rel="stylesheet" href="/neil_vue_press/assets/css/0.styles.b423781f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/neil_vue_press/" class="home-link router-link-active"><!----> <span class="site-name">持续变强</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/neil_vue_press/topic/" class="nav-link router-link-active">
  专题学习
</a></div><div class="nav-item"><a href="/neil_vue_press/Interview/" class="nav-link">
  理论学习
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/neil_vue_press/topic/" class="nav-link router-link-active">
  专题学习
</a></div><div class="nav-item"><a href="/neil_vue_press/Interview/" class="nav-link">
  理论学习
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>应用框架(Frame)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具集合(Tools)</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>工程架构系列</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/neil_vue_press/topic/engineering.html" class="sidebar-link">章节概览</a></li><li><a href="/neil_vue_press/topic/engineering-lagou-start.html" class="sidebar-link">拉钩-前端基础建设与架构30讲-开篇</a></li><li><a href="/neil_vue_press/topic/enginneering-management-tool.html" aria-current="page" class="active sidebar-link">前端工程化管理工具篇</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/neil_vue_press/topic/enginneering-management-tool.html#_1-js-包管理工具和原理分析-npm-安装机制和企业级部署私服原理" class="sidebar-link">1. JS 包管理工具和原理分析：npm 安装机制和企业级部署私服原理</a></li><li class="sidebar-sub-header"><a href="/neil_vue_press/topic/enginneering-management-tool.html#_2-yarn-的安装理念及如何破解依赖管理困境" class="sidebar-link">2. Yarn 的安装理念及如何破解依赖管理困境</a></li><li class="sidebar-sub-header"><a href="/neil_vue_press/topic/enginneering-management-tool.html#_3-ci-环境上的-npm-优化及更多工程化问题解析" class="sidebar-link">3. CI 环境上的 npm 优化及更多工程化问题解析</a></li><li class="sidebar-sub-header"><a href="/neil_vue_press/topic/enginneering-management-tool.html#_4-横向对比主流构建工具-了解构建工具的设计考量" class="sidebar-link">4. 横向对比主流构建工具，了解构建工具的设计考量</a></li><li class="sidebar-sub-header"><a href="/neil_vue_press/topic/enginneering-management-tool.html#_5-vite实现-从源码分析出发-构建bundleless开发工程" class="sidebar-link">5. Vite实现：从源码分析出发，构建bundleless开发工程</a></li></ul></li><li><a href="/neil_vue_press/topic/enginneering-Architecture-ecosystem.html" class="sidebar-link">现代化前端开发和架构生态篇</a></li><li><a href="/neil_vue_press/topic/engineering-Design-patterns.html" class="sidebar-link">核心框架原理与代码设计模式篇</a></li><li><a href="/neil_vue_press/topic/engineering-actual-combat.html" class="sidebar-link">前端架构设计实战篇</a></li><li><a href="/neil_vue_press/topic/engineering-Full-stack.html" class="sidebar-link">前端全链路-Node.js全栈开发篇</a></li><li><a href="/neil_vue_press/topic/engineering-lagou-end.html" class="sidebar-link">拉钩-结束语</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微前端系列集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>低代码系列集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>多端跨端系列</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务器渲染集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>动效可视化集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务端知识集</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术探索攻略</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端工程化管理工具篇"><a href="#前端工程化管理工具篇" class="header-anchor">#</a> 前端工程化管理工具篇</h1> <h2 id="_1-js-包管理工具和原理分析-npm-安装机制和企业级部署私服原理"><a href="#_1-js-包管理工具和原理分析-npm-安装机制和企业级部署私服原理" class="header-anchor">#</a> 1. JS 包管理工具和原理分析：npm 安装机制和企业级部署私服原理</h2> <h3 id="npm-内部机制和核心原理"><a href="#npm-内部机制和核心原理" class="header-anchor">#</a> npm 内部机制和核心原理：</h3> <ol><li>安装机制：Ruby 的 Gem 和 Python 的 pip 都是全局安装，但是 npm 会优先安装依赖到当前项目目录中，这样达到各个项目依赖的分离。</li> <li>install 执行之后，首先检查并获取 npm 配置，这里的优先级是：项目级的.npmrc 文件=》用户级的.npmrc 文件=》全局级的.npmrc 文件=》npm 内置的.npmrc 文件 npm config ls -l</li> <li>最佳实践：同一个项目团队，应该保持 npm 版本的一致性。</li> <li>构建依赖树的过程：</li></ol> <h3 id="npm-缓存机制"><a href="#npm-缓存机制" class="header-anchor">#</a> npm 缓存机制：</h3> <ol><li>官方链接：https://docs.npmjs.com/downloading-and-installing-node-js-and-npm</li> <li>对一个依赖包的同一版本进行本地化的缓存，是当代依赖包管理工具的一个常见设计。</li> <li>npm config get cache : 得到缓存的路径</li> <li>npm cache clean --force</li> <li>缓存文件都在_cacache 文件夹下：下面的 content-v2 是 npm 包资源；下面的 index-v5 是一些描述性的文件，其实是 content-v2 包资源的索引</li> <li>缓存如何被储存和利用：
npm install 时，先下载包到缓存中，再利用<a href="https://www.npmjs.com/package/pacote" target="_blank" rel="noopener noreferrer">pacote<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（依赖<a href="https://github.com/npm/npm-registry-fetch#npm-registry-fetch" target="_blank" rel="noopener noreferrer">npm-registry-fetch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，可以配置 cache，给固定的路径下载，根据<a href="https://datatracker.ietf.org/doc/rfc7234/" target="_blank" rel="noopener noreferrer">IETF RFC 7234<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>生产缓存数据）把包解压到 node_module 中</li> <li>这里提到的缓存机制是从 npm v5 开始的。</li> <li>【能不能在理论内容上多走一步，也决定了技术能力能不能更上一层楼】</li></ol> <h3 id="npm-不完全指南"><a href="#npm-不完全指南" class="header-anchor">#</a> npm 不完全指南：</h3> <ol><li><a href="https://docs.npmjs.com/cli-documentation/" target="_blank" rel="noopener noreferrer">npm cli 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>自定义<a href="https://docs.npmjs.com/cli/v7/commands/npm-init" target="_blank" rel="noopener noreferrer">npm init<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:
<ul><li>快速构建一个满足自我需求的自定义项目，调用 shell 脚本输出一个 package.json 文件，module.export 就是 package.json 的内容</li> <li><a href="https://docs.npmjs.com/cli/v7/commands/npm-config" target="_blank" rel="noopener noreferrer">npm config<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>利用 npm link，高效率本地调试包的可用性
<ul><li>在开发包目录下执行 npm link，使开发包链接到全局；</li> <li>在本地项目目录下执行 npm link xxx（自定义包名）</li> <li>从工作原理上总结：为目标模块创建软链接，将其链接到 node 模块全局安装路径：/usr/local/lib/node_modules/；为目标模块的可执行 bin 文件创建软链接，将其链接到 node 命令安装路径/usr/local/bin/。</li></ul></li> <li>npx 的作用：
<ul><li>由 npm v5.2 引进，解决了 npm 的快速开发、快速调试，以及项目内使用全局模块的痛点。</li> <li>npx 执行模块时会优先安装依赖，但是在安装执行依赖后会删除依赖，这样可以避免全局安装模块带来的问题。</li> <li><a href="https://www.npmjs.com/package/npx" target="_blank" rel="noopener noreferrer">官方介绍链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>npm 多源镜像以及企业级部署私服原理
<ul><li>npm 中的源（registry），其实就是一个查询服务。</li> <li>3 种工具搭建 npm 私服：nexus、verdaccio、cnpm。</li> <li>eg：nexus 工作在 client 和外部 npm 之间，并通过 group repository 合并 npm 仓库以及私有仓库，这样就起到了代理转发的作用。</li> <li>npm 配置作用优先级：
命令行的 npm 配置 &gt; evn 的 npm 配置 &gt; 项目级的.npmrc 文件 &gt; 用户级的.npmrc 文件 &gt; 全局级的.npmrc 文件 &gt; npm 内置的.npmrc 文件'</li> <li>npm 镜像和安装问题：<a href="https://mp.weixin.qq.com/s/2ntKGIkR3Uiy9cQfITg2NQ" target="_blank" rel="noopener noreferrer">推荐文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>依赖版本规范：<a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener noreferrer">官方链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，x.y.z，x 是主版本号，做了不向下兼容的更新；y 是次版本号，做了向下兼容的新增功能；z 是修订号，做了向下兼容的修改更新；</li></ol> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题：</h3> <ol><li>a 引用 b 版本号 2.0，c 引用 b 版本号 3.0，这样 install 后，会下载 b 包 2.0 和 3.0 吗？</li></ol> <h2 id="_2-yarn-的安装理念及如何破解依赖管理困境"><a href="#_2-yarn-的安装理念及如何破解依赖管理困境" class="header-anchor">#</a> 2. Yarn 的安装理念及如何破解依赖管理困境</h2> <ol><li>Yarn 是为了解决 npm 的某些不足（npm 对于依赖的完整性和一致性保障，以及 npm 安装速度过慢等问题）</li></ol> <h3 id="优势"><a href="#优势" class="header-anchor">#</a> 优势：</h3> <ul><li>确定性：通过 yarn.lock 等机制，保证了确定性。</li> <li>采用模块扁平安装模式：将依赖包的不同版本，按照一定策略，归结为单个版本，以避免创建多个副本造成冗余(npm 目前也有相同优化)</li> <li>网络性能更好：Yarn 采用请求排队理念，并发连接池，同时引进安装失败时的重试机制。</li> <li>采用缓存机制，实现了离线模式（npm 目前也有类似实现）</li></ul> <h3 id="不同"><a href="#不同" class="header-anchor">#</a> 不同：</h3> <ul><li>yarn.lock 文件中子版本号不是固定的，还需要结合 package.json 来决定；</li> <li>yarn cache dir：查看缓存目录</li></ul> <h3 id="yarn-安装机制和背后思想"><a href="#yarn-安装机制和背后思想" class="header-anchor">#</a> Yarn 安装机制和背后思想：</h3> <ul><li>检测包（checking）：检查是否存在 npm 相关文件：package-lock.json，如果有，会提示可能导致冲突。</li> <li>解析包（Resolving Packages）</li> <li>获取包（Fetching Packages）</li> <li>链接包（Linking Packages）</li> <li>构建包（Building Packages）</li></ul> <h3 id="破解依赖管理困境"><a href="#破解依赖管理困境" class="header-anchor">#</a> 破解依赖管理困境：</h3> <ul><li>“嵌套地狱”：安装时间长；</li> <li>window 系统可能出现删除失败的情况；</li> <li>浪费较大的空间资源；</li> <li>npm 包的安装顺序对依赖树的影响很大，可能影响 node_modules 下的文件数量；</li> <li>yarn 的安装依赖时，<strong>会自动执行 dedupe（npm dedupe）命令，实现扁平化的安装模式</strong>，这是关键。</li></ul> <h2 id="_3-ci-环境上的-npm-优化及更多工程化问题解析"><a href="#_3-ci-环境上的-npm-优化及更多工程化问题解析" class="header-anchor">#</a> 3. CI 环境上的 npm 优化及更多工程化问题解析</h2> <ol><li>CI 环境上的 npm 优化</li> <li>合理使用 npm ci 和 npm install：npm ci 是专门为 CI 环境准备的安装命令，与 npm install 的不同之处：
<ul><li><ol><li>npm ci 要求项目中必须存在 package-lock.json 或 npm-shrinkwrap.json;</li></ol></li> <li><ol start="2"><li>npm ci 完全根据 package-lock.json 安装依赖，这可以保证整个开发团队都使用版本完全一致的依赖；同时不需要计算求解依赖满足问题、构造依赖树，所以安装过程也更快；</li></ol></li> <li><ol start="3"><li>npm ci 在安装时，会先删除现有的 node_modules，然后再全新安装；</li></ol></li> <li><ol start="4"><li>npm ci 只能一次安装整个项目所有依赖包，无法安装单个依赖包；</li></ol></li> <li><ol start="5"><li>如果 package-lock.json 和 package.json 冲突，那么 npm ci 会直接报错，并非更新 lockfile；</li></ol></li> <li><ol start="6"><li>npm ci 永远不会改变 package.json 和 package-lock.json；</li></ol></li> <li><ol start="7"><li><a href="https://docs.npmjs.com/cli/ci.html" target="_blank" rel="noopener noreferrer">官方链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></li></ul></li> <li>使用 package-lock.json 优化依赖安装时间</li></ol> <h3 id="更多工程化相关问题解析"><a href="#更多工程化相关问题解析" class="header-anchor">#</a> 更多工程化相关问题解析：</h3> <h4 id="为什么要-lockfiles-要不要提交-lockfile-到仓库"><a href="#为什么要-lockfiles-要不要提交-lockfile-到仓库" class="header-anchor">#</a> 为什么要 lockfiles，要不要提交 lockfile 到仓库？</h4> <ol><li>pack-lock.json 文件的作用是锁定依赖安装结构，目的是保证在任意机器上执行 npm install 都会得到完全相同的 node_modules 安装结果</li> <li>（追求极致，深挖原因，用合理的做法解决问题）</li> <li>推荐做法：把 package-lock.json 一起提交到代码库，不需要 ignore。但是执行 npm publish 命令，发布一个库的时候，应该忽略它而不是直接发布出去。</li></ol> <h4 id="为什么有-xxxdependencies"><a href="#为什么有-xxxdependencies" class="header-anchor">#</a> 为什么有 xxxDependencies？</h4> <ol><li>dependencies 项目依赖：会成为线上生产环境中的代码组成部分。</li> <li>devDependencies 开发依赖，不会被自动下载：依赖是否被打包，完全取决于项目里是否被引入了该模块。</li> <li>peerDependencies 表示同版本依赖：
<ul><li><ol><li>插件不能单独运行；</li></ol></li> <li><ol start="2"><li>插件正确运行的前提是核心依赖库必须先下载安装；</li></ol></li> <li><ol start="3"><li>不希望核心依赖库被重复下载；</li></ol></li> <li><ol start="4"><li>插件 API 的设计必须要符合核心依赖库的插件编写规范；</li></ol></li> <li><ol start="5"><li>在项目中，同一插件体系下，核心依赖库版本最好相同；</li></ol></li></ul></li> <li>bundledDependencies 和 npm pack 打包命令有关：在 bundledDependencies 中指定的依赖包，必须先在 dependencies 和 devDependencies 声明过，否则在 npm pack 阶段会进行报错。</li> <li>optionalDependencies 表示可选依赖，不建议使用。</li></ol> <h4 id="再谈版本规范-依赖库锁版本行为解析"><a href="#再谈版本规范-依赖库锁版本行为解析" class="header-anchor">#</a> 再谈版本规范--依赖库锁版本行为解析</h4> <ol><li>create-react-app 会进行核心依赖版本检查</li></ol> <h4 id="扩展"><a href="#扩展" class="header-anchor">#</a> 扩展</h4> <ol><li><a href="https://zhuanlan.zhihu.com/p/352437367" target="_blank" rel="noopener noreferrer">pnpm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：TODO</li></ol> <h2 id="_4-横向对比主流构建工具-了解构建工具的设计考量"><a href="#_4-横向对比主流构建工具-了解构建工具的设计考量" class="header-anchor">#</a> 4. 横向对比主流构建工具，了解构建工具的设计考量</h2> <ol><li>Browserify + Gulp=&gt;Parcel，Webpack=&gt;Rollup=&gt;Vite</li></ol> <h3 id="_6-大重点考量环节"><a href="#_6-大重点考量环节" class="header-anchor">#</a> 6 大重点考量环节：</h3> <ol><li>Code Splitting：代码分割。能够导出公共模块，避免重复打包，以及在页面加载运行时，实现最合理的按需加载策略。构建工具的标配</li> <li>Hashing：对打包资源进行版本信息映射。==》最大化地利用缓存机制。构建工具进行打包的前提就是对各个模块依赖关系进行分析，并根据依赖关系，支持开发者自行定义哈希策略（比如，Webpack 提供 hash、chunkhash、contenthash 策略）
<ul><li><ol><li>hash 反映了项目的构建版本，不足：即使模块内容没有变化，重新构建后会产生新的 hash 值，使得缓存命中率较低。</li></ol></li> <li><ol start="2"><li>chunkhash 会根据入口文件（Entry）进行依赖解析。</li></ol></li> <li><ol start="3"><li>contenthash 则会根据文件具体内容，生成 hash 值。</li></ol></li> <li><ol start="4"><li><a href="https://medium.com/@sahilkkrazy/hash-vs-chunkhash-vs-contenthash-e94d38a32208" target="_blank" rel="noopener noreferrer">区别解释链接<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></li></ul></li> <li>Importing Modules：即依赖机制。兼容 ESM、CommonJS、从 node_module 引入公共包的支持。</li> <li>Non-JavaScript Resources：是指对其他非 JavaScript 类型资源导入的支持能力。</li> <li>Output Module Formats：导出模式要灵活，可以配置 ESM、CommonJS 等规范的内容</li> <li>Transformations：编译、转义过程。对 JavaScript 代码的压缩，无用代码的删除。构建工具只做构建分内的事情，其他扩展能力通过插件化机制来完成。</li></ol> <h2 id="_5-vite实现-从源码分析出发-构建bundleless开发工程"><a href="#_5-vite实现-从源码分析出发-构建bundleless开发工程" class="header-anchor">#</a> 5. Vite实现：从源码分析出发，构建bundleless开发工程</h2> <p>20220626 下午 铭科苑F6 热<br>
静下心来读Vite源码，发现也并不难读懂。
<a href="https://cn.vitejs.dev/guide/" target="_blank" rel="noopener noreferrer">官链<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li>Vite关键点：
<ul><li>Vite基于ESM，实现了快速启动和即时模块热更新的能力。</li> <li>Vite在服务端实现了按需编译。</li> <li>Vite在开发环境下并没有打包和构建的过程。</li></ul></li> <li>runServer的实现：20220627（Vite的源码真的是很易读，真的可以学到很实用的写法啊），启动一个KoaServer，来实现对浏览器请求的响应。</li> <li>createServer的实现：</li> <li>ESM规范：当出现script标签属性type为mudule时，浏览器则会请求相应的模块内容。</li></ol> <h3 id="功能总结"><a href="#功能总结" class="header-anchor">#</a> 功能总结：</h3> <ol><li>Vite利用浏览器原生支持ESM特性，直接省略了打包过程，不需要生成bundle，因此初次更快，HMR更友好。</li> <li>Vite在开发模式下，利用Koa服务，直接处理<strong>模块的改写</strong>和<strong>请求的处理</strong>，真正做到了按需加载。</li> <li>Vite的服务端基本都是靠中间件来处理，过程如下：
<ul><li><ol><li>处理ESM语法，把代码中的import第三方模块的路径处理成浏览器可以识别的路径</li></ol></li> <li><ol start="2"><li>对ts、vue文件进行即时编译</li></ol></li> <li><ol start="3"><li>Sass、Less这种需要预编译的进行编译</li></ol></li> <li><ol start="4"><li>和浏览器建立Socket连接，实现HMR</li></ol></li></ul></li> <li>与webpack打包对比图
<img src="/neil_vue_press/assets/img/ViteVSwebpack-1.80004c37.png" alt="图一"> <img src="/neil_vue_press/assets/img/ViteVSwebpack-2.9c616bc3.png" alt="图二"></li></ol> <h3 id="hmr的实现原理"><a href="#hmr的实现原理" class="header-anchor">#</a> HMR的实现原理</h3> <ol><li>通过watcher实现文件监听</li> <li>通过server端编译资源，并推送新模块内容给浏览器</li> <li>浏览器接收到新模块内容后，执行框架层面的rerender/reload</li> <li></li></ol> <p><img src="/neil_vue_press/assets/img/HMR_summary.890c5d0f.png" alt="HMR总结图"></p> <h3 id="小节总结"><a href="#小节总结" class="header-anchor">#</a> 小节总结：</h3> <ol><li>Vite的设计灵感来源于<a href="https://www.snowpack.dev/" target="_blank" rel="noopener noreferrer">Snowpack<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> （再次强调了学习英语的重要性，可以一下子开阔自己的世界眼光）</li> <li>技术功底很重要，但是对新技术的敏感度的培养也很重要。</li> <li>知识获取方式：看官网 =&gt; 看源码 =&gt; 去github提issue/pr =&gt; 多参与国际设计的讨论</li> <li>Vite支持改造，所以也可以支持React项目</li> <li>20220628晚-北京-小雨: 除去浮躁的追逐新技术亮点，沉下心来钻研推敲某个具体的知识点，真的是非常有收获，而且知识好多是类似的，疲于追逐意义也不大。</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/neil_vue_press/topic/engineering-lagou-start.html" class="prev">
        拉钩-前端基础建设与架构30讲-开篇
      </a></span> <span class="next"><a href="/neil_vue_press/topic/enginneering-Architecture-ecosystem.html">
        现代化前端开发和架构生态篇
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/neil_vue_press/assets/js/app.ce6058cf.js" defer></script><script src="/neil_vue_press/assets/js/2.616e7873.js" defer></script><script src="/neil_vue_press/assets/js/1.6e2e3eb2.js" defer></script><script src="/neil_vue_press/assets/js/19.d3e902f6.js" defer></script>
  </body>
</html>
