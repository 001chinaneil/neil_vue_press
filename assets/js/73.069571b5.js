(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{355:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"react-apollo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-apollo"}},[t._v("#")]),t._v(" React-Apollo")]),t._v(" "),s("p",[t._v("20220326")]),t._v(" "),s("ul",[s("li",[t._v("为什么要用？")]),t._v(" "),s("li",[t._v("亮点或优势是什么？")]),t._v(" "),s("li",[t._v("收益是什么？")])]),t._v(" "),s("p",[t._v("20220401 新华科技大厦 第一遍学完")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://apollographqlcn.github.io/react-docs-cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("React-Apollo官链"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://graphql.cn/graphql-js/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GraphQL.JS官方教程"),s("OutboundLink")],1),t._v(" 很好！"),s("br"),t._v(" "),s("a",{attrs:{href:"https://www.apollographql.com/docs/react/data/queries",target:"_blank",rel:"noopener noreferrer"}},[t._v("React-Apollo官链英文版"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"第一部分-basics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一部分-basics"}},[t._v("#")]),t._v(" 第一部分：Basics")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Apollo是React、GraphQL的集成框架")])]),t._v(" "),s("li",[s("p",[t._v("GraphQL："),s("br"),t._v("\n2.1 模式是包含字段的对象类型的集合。"),s("br"),t._v("\n2.2")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 字段之间不用逗号分割")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"注释的格式xxxx"')]),t._v("\ntype SpaceCat "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 代表字符串类型，不能为空")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int  \n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("missions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Mission"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 表示包含一个列表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("2.3 Query类型是可以让GraphQL服务器可以识别的，可以知道检索的是什么，是顶级字段。schema是后端提供给前端的")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务器gql写法 可以嵌套复用")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" typeDefs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gql"),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n    # write your schema definitions here\n    type Query {\n        spaceCats: [SpaceCat]\n    }\n\n    type SpaceCat {\n        id: ID!\n        name: String!\n        age: Int\n        missions: [Mission]\n    }\n\n    type Mission {\n        id: ID!\n        name: String!\n        description: String!\n    }\n")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n")])])]),s("p",[t._v("2.4 graphql提供解析GraphQL查询的核心逻辑；@apollo/client包含构建客户端所需的一切，比如内存缓存、本地状态管理、错误处理。"),s("br"),t._v("\n2.5 通过包裹根组件，让所有组件都可以使用apollo/client")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("ReactDOM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ApolloProvider client"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("GlobalStyles "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("    \n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Pages "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ApolloProvider"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'root'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("2.6 客户端FE的gql写法：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** TRACKS query to retrieve all tracks */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TRACKS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gql"),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n    query getTracks {\n        tracksForHome {\n            id\n            title\n            thumbnail\n            length\n            modulesCount\n            author {\n                name\n                photo\n            }\n        }\n    }\n")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("2.7 在客户端是用@apollo/client中提供的useQuery执行查询")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在React的UI组件里面进行使用")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" loading"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useQuery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TRACKS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("2.8 graphiql是简化前端js查询的一个工具，直接写期望的返回数据格式就可以")])])]),t._v(" "),s("h2",{attrs:{id:"第二部分-resolvers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二部分-resolvers"}},[t._v("#")]),t._v(" 第二部分：Resolvers")]),t._v(" "),s("ol",[s("li",[t._v("解析器检索的数据可以来自各个地方：数据库、第三方API、webhook，它们之间可以任意混合。")]),t._v(" "),s("li",[t._v("典型的N+1问题，相同的一个接口，调用N次来获取结果格式相同而内容不同的数据")]),t._v(" "),s("li",[t._v("解析器的作用是为字段填充数据，它是一个函数，将数据转换成客户端需要的样子。")]),t._v(" "),s("li",[t._v("解析器有4个参数：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 该字段父级解析器的返回值\nargs：对象，是所有GraphQL参数\ncontext：所有解析器共享的对象\ninfo：包含有关操作执行状态的信息\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("Apollo Server是模式Schema、解析器、数据源完美协调的地方")])]),t._v(" "),s("h2",{attrs:{id:"第三部分-arguments"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三部分-arguments"}},[t._v("#")]),t._v(" 第三部分：Arguments")]),t._v(" "),s("ol",[s("li",[t._v("The "),s("code",[t._v("Query")]),t._v(" type contains the entry points to our schema. In future courses, we'll take a look at 2 other possible entry points: "),s("code",[t._v("Mutation")]),t._v(" and "),s("code",[t._v("Subscription")]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"第四部分-mutations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四部分-mutations"}},[t._v("#")]),t._v(" 第四部分：Mutations")]),t._v(" "),s("ol",[s("li",[t._v("写的操作：mutations")]),t._v(" "),s("li",[t._v("Mutation names should start with a verb, followed by whatever data you're modifying! eg: "),s("code",[t._v("deleteMission")]),t._v("、"),s("code",[t._v("createMission")])]),t._v(" "),s("li")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 例如：build the useMutation hook here")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("assignSpaceship"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("loading"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useMutation")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ASSIGN_SPACESHIP_MUTATION")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("variables")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" spaceshipId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" missionId "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"第五部分-production-the-schema-registry"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第五部分-production-the-schema-registry"}},[t._v("#")]),t._v(" 第五部分：Production & the Schema Registry")]),t._v(" "),s("ol",[s("li",[t._v("生产环境部署")]),t._v(" "),s("li",[t._v("用Heroku进行上线，它是a cloud service platform。"),s("a",{attrs:{href:"https://dashboard.heroku.com/terms-of-service",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方地址"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Client部署：done")])])])}),[],!1,null,null,null);s.default=e.exports}}]);